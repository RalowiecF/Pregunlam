<!-- Cargar estilos desde W3.CSS y Leaflet directamente -->
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

<style>
    #map {
        height: 100px;
        margin-top: 8px;
    }

    .activo {
        background-color: #00EF48 !important;
        color: white !important;
    }
</style>


<div>
    <div class="container">
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid" style="justify-content: space-around">
                <ul class="w3-ul w3-hoverable" style="font-size:1.3rem;cursor:pointer; display: flex;">
                    <li class="w3-padding-large activo" onclick="mostrarSeccion('informacionPersonal')">Informacion
                        Personal
                    </li>
                    <li class="w3-padding-large activo" onclick="mostrarSeccion('historialPartidas')">Historial
                        Partidas
                    </li>
                    <li class="w3-padding-large activo" style="border-bottom: 1px solid #ddd" onclick="mostrarSeccion('configuracion')">Configuracion</li>
                </ul>
            </div>
        </nav>
    </div>

    <div style="margin-left:auto">
        <!-- Informacion Personal -->
        <div class="w3-card w3-white w3-padding w3-content seccion"
             id="informacionPersonal"
             style="max-width:1000px; margin-top: 3rem">
            <div class="w3-row-padding" style="min-width: 60rem">
                <!-- Columna 1 -->
                <div class="w3-half">
                    <img src="{{BASE_URL}}/imagenes/usuario.png" alt="Foto de Perfil"
                         style="width:150px; height:150px; object-fit:cover; border-radius:50%; display:block; margin-bottom: 1rem;border: solid">
                    <h2>Usuario:{{usuarioLogueado.nombreUsuario}}</h2>
                    <h3><i class="fa-solid fa-globe"></i>{{usuarioLogueado.pais}}</h3>
                    <div id="map" class="w3-border" style="height: 250px;"></div>
                </div>

                <div class="w3-half">
                    <h3>Nombre:{{usuarioLogueado.nombre}}</h3>
                    <h3>Apellido:{{usuarioLogueado.apellido}}</h3>
                    <h3>Email:{{usuarioLogueado.mail}}</h3>
                    <h3>Puntuacion:{{usuarioLogueado.puntaje}}</h3>
<!--                    <img src="data:image/png;base64,{{qrBase64}}" alt="QR Perfil">-->
                    <img src="{{qrUrl}}" alt="Código QR del perfil">
                </div>

            </div>
        </div>

        <!-- Historial Partidas -->
        <div class="w3-light-grey w3-center seccion"
             id="historialPartidas"
             style="min-height:70vh;display:flex;flex-direction:column;justify-content:flex-start;align-items:center;margin-top: 3rem;padding-top:10px;">
            <!-- Contenedor de la tabla -->
            <div class="w3-card-4 w3-white w3-round-large"
                 style="width:90%;max-width:1000px;overflow:hidden;margin-bottom:5px;">
                <table class="w3-table w3-bordered w3-hoverable w3-centered" id="partidasTabla" style="margin:0;">
                    <thead style="background-color:#00EF48;color:white;">
                    <tr>
                        <th>Fecha Partida</th>
                        <th>Duracion Partida</th>
                    </tr>
                    </thead>
                    <tbody id="tablaBody">
                    {{#partidasJugadas}}
                        <tr>
                            <td>{{fechaPartida}}</td>
                            <td>{{duracionPartida}}</td>
                        </tr>
                    {{/partidasJugadas}}
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Configuracion -->
        <div class="w3-light-grey w3-center seccion"
             id="configuracion"
             style="min-height:70vh;display:flex;flex-direction:column;justify-content:flex-start;align-items:center;margin-top: 3rem;padding-top:10px;">
        </div>
    </div>
</div>

<!-- SCRIPTS: validación y mapa -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // Validar contraseña
    function validarFormulario() {
        const pass = document.getElementById("contraseña").value;
        const confirm = document.getElementById("confirmarContraseña").value;
        if (pass !== confirm) {
            alert("Las contraseñas no coinciden.");
            return false;
        }
        return true;
    }

    // Iniciar mapa
    const lat = {{#usuarioLogueado}}{{usuarioLogueado.latitud}}{{/usuarioLogueado}}{{^usuarioLogueado}}-34.6037{{/usuarioLogueado}};
    const lng = {{#usuarioLogueado}}{{usuarioLogueado.longitud}}{{/usuarioLogueado}}{{^usuarioLogueado}}-58.3816{{/usuarioLogueado}};
    const map = L.map('map').setView([lat, lng], 9); // Buenos Aires

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    let marker;
    map.on('click', function (e) {
        const lat = e.latlng.lat.toFixed(6);
        const lng = e.latlng.lng.toFixed(6);
        document.getElementById('latitud').value = lat;
        document.getElementById('longitud').value = lng;

        if (marker) {
            marker.setLatLng(e.latlng);
        } else {
            marker = L.marker(e.latlng).addTo(map);
        }
    });


    function mostrarSeccion(id) {
        document.querySelectorAll('.seccion').forEach(div => {
            div.style.display = 'none';
        });

        document.getElementById(id).style.display = 'flex';

        // Marcar el menú activo
        document.querySelectorAll('.w3-ul li').forEach(li => li.classList.remove('activo'));
        const index = {informacionPersonal: 0, historialPartidas: 1, configuracion: 2}[id];
        document.querySelectorAll('.w3-ul li')[index].classList.add('activo');
    }

    window.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.seccion').forEach(div => div.style.display = 'none');
        document.getElementById('informacionPersonal').style.display = 'flex';
        document.querySelectorAll('.w3-ul li').forEach(li => li.classList.remove('activo'));
    });
</script>

